use contracts::tests::test_utils::{setup_contracts_for_testing};
use core::result::ResultTrait;

use evm::instructions::system_operations::SystemOperationsTrait;

use evm::memory::MemoryTrait;
use evm::precompiles::modexp::ModExpPrecompileTrait;
use evm::stack::StackTrait;
use evm::tests::test_utils::{VMBuilderTrait, native_token, other_starknet_address};
use starknet::testing::set_contract_address;
use utils::helpers::U256Trait;

#[test]
// name: "eth_tests_modexp_modsize0_returndatasizeFiller"
fn test_mod_exp_precompile_0() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        100,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        100,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        100,
        84,
        66,
        221,
        194,
        183,
        15,
        102,
        193,
        246,
        210,
        178,
        150,
        192,
        168,
        117,
        190,
        126,
        221,
        208,
        168,
        9,
        88,
        203,
        199,
        66,
        95,
        24,
        153,
        204,
        249,
        5,
        17,
        165,
        195,
        24,
        34,
        110,
        72,
        238,
        35,
        241,
        48,
        180,
        77,
        193,
        122,
        105,
        28,
        230,
        107,
        229,
        218,
        24,
        184,
        94,
        215,
        148,
        53,
        53,
        178,
        5,
        170,
        18,
        94,
        159,
        89,
        41,
        74,
        0,
        240,
        81,
        85,
        194,
        62,
        151,
        218,
        198,
        179,
        160,
        11,
        12,
        99,
        200,
        65,
        27,
        248,
        21,
        252,
        24,
        59,
        66,
        11,
        77,
        157,
        197,
        247,
        21,
        4,
        13,
        92,
        96,
        149,
        127,
        82,
        211,
        52,
        184,
        67,
        25,
        122,
        222,
        197,
        140,
        19,
        28,
        144,
        124,
        217,
        96,
        89,
        252,
        90,
        220,
        233,
        221,
        163,
        81,
        181,
        223,
        61,
        102,
        111,
        207,
        62,
        182,
        60,
        70,
        133,
        28,
        24,
        22,
        227,
        35,
        242,
        17,
        158,
        189,
        245,
        239,
        53
    ]
        .span();

    let expected = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
    ]
        .span();

    vm.message.data = calldata;

    let expected_gas = 44_954;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
//  name: "eth_tests_create2callPrecompiles_test0_berlin",
fn test_mod_exp_precompile_1() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        3,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        254,
        255,
        255,
        252,
        46,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        47
    ]
        .span();

    let expected = array![
        22,
        46,
        173,
        130,
        202,
        222,
        250,
        234,
        246,
        233,
        40,
        50,
        72,
        253,
        242,
        242,
        132,
        95,
        99,
        150,
        246,
        241,
        124,
        77,
        90,
        57,
        248,
        32,
        182,
        246,
        181,
        249
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 1_360;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "eip198_example_1",
fn test_mod_exp_precompile_2() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        3,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        254,
        255,
        255,
        252,
        46,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        254,
        255,
        255,
        252,
        47
    ]
        .span();
    let expected = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 1_360;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "eip198_example_2"
fn test_mod_exp_precompile_3() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        254,
        255,
        255,
        252,
        46,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        255,
        254,
        255,
        255,
        252,
        47
    ]
        .span();
    let expected = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 1_360;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}


#[test]
// name: "nagydani_1_square",
fn test_mod_exp_precompile_4() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        224,
        154,
        217,
        103,
        84,
        101,
        197,
        58,
        16,
        159,
        172,
        102,
        164,
        69,
        201,
        27,
        41,
        45,
        43,
        178,
        197,
        38,
        138,
        221,
        179,
        12,
        216,
        47,
        128,
        252,
        176,
        3,
        63,
        249,
        124,
        128,
        165,
        252,
        111,
        57,
        25,
        58,
        233,
        105,
        198,
        237,
        230,
        113,
        10,
        107,
        122,
        194,
        112,
        120,
        160,
        109,
        144,
        239,
        28,
        114,
        229,
        200,
        95,
        181,
        2,
        252,
        158,
        31,
        107,
        235,
        129,
        81,
        101,
        69,
        151,
        82,
        24,
        7,
        94,
        194,
        175,
        17,
        140,
        216,
        121,
        141,
        246,
        224,
        138,
        20,
        124,
        96,
        253,
        96,
        149,
        172,
        43,
        176,
        44,
        41,
        8,
        207,
        77,
        215,
        200,
        31,
        17,
        194,
        137,
        228,
        188,
        233,
        143,
        53,
        83,
        118,
        143,
        57,
        42,
        128,
        206,
        34,
        191,
        92,
        79,
        74,
        36,
        140,
        107
    ]
        .span();
    let expected = array![
        96,
        0,
        143,
        22,
        20,
        204,
        1,
        220,
        251,
        107,
        251,
        9,
        198,
        37,
        207,
        144,
        180,
        125,
        68,
        104,
        219,
        129,
        181,
        248,
        183,
        163,
        157,
        66,
        243,
        50,
        234,
        185,
        178,
        218,
        143,
        45,
        149,
        49,
        22,
        72,
        168,
        242,
        67,
        244,
        187,
        19,
        207,
        179,
        216,
        247,
        242,
        163,
        192,
        20,
        18,
        46,
        187,
        62,
        212,
        27,
        2,
        120,
        58,
        220
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 200;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "nagydani_1_qube"
fn test_mod_exp_precompile_5() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        224,
        154,
        217,
        103,
        84,
        101,
        197,
        58,
        16,
        159,
        172,
        102,
        164,
        69,
        201,
        27,
        41,
        45,
        43,
        178,
        197,
        38,
        138,
        221,
        179,
        12,
        216,
        47,
        128,
        252,
        176,
        3,
        63,
        249,
        124,
        128,
        165,
        252,
        111,
        57,
        25,
        58,
        233,
        105,
        198,
        237,
        230,
        113,
        10,
        107,
        122,
        194,
        112,
        120,
        160,
        109,
        144,
        239,
        28,
        114,
        229,
        200,
        95,
        181,
        3,
        252,
        158,
        31,
        107,
        235,
        129,
        81,
        101,
        69,
        151,
        82,
        24,
        7,
        94,
        194,
        175,
        17,
        140,
        216,
        121,
        141,
        246,
        224,
        138,
        20,
        124,
        96,
        253,
        96,
        149,
        172,
        43,
        176,
        44,
        41,
        8,
        207,
        77,
        215,
        200,
        31,
        17,
        194,
        137,
        228,
        188,
        233,
        143,
        53,
        83,
        118,
        143,
        57,
        42,
        128,
        206,
        34,
        191,
        92,
        79,
        74,
        36,
        140,
        107
    ]
        .span();
    let expected = array![
        72,
        52,
        164,
        107,
        165,
        101,
        219,
        39,
        144,
        59,
        28,
        114,
        12,
        157,
        89,
        62,
        132,
        228,
        203,
        214,
        173,
        46,
        100,
        179,
        24,
        133,
        217,
        68,
        246,
        140,
        216,
        1,
        249,
        34,
        37,
        168,
        150,
        28,
        149,
        45,
        223,
        39,
        151,
        250,
        71,
        1,
        179,
        48,
        200,
        92,
        75,
        54,
        55,
        152,
        16,
        11,
        146,
        26,
        26,
        34,
        164,
        106,
        127,
        236
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 200;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "nagydani_1_pow0x10001"
fn test_mod_exp_precompile_6() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        224,
        154,
        217,
        103,
        84,
        101,
        197,
        58,
        16,
        159,
        172,
        102,
        164,
        69,
        201,
        27,
        41,
        45,
        43,
        178,
        197,
        38,
        138,
        221,
        179,
        12,
        216,
        47,
        128,
        252,
        176,
        3,
        63,
        249,
        124,
        128,
        165,
        252,
        111,
        57,
        25,
        58,
        233,
        105,
        198,
        237,
        230,
        113,
        10,
        107,
        122,
        194,
        112,
        120,
        160,
        109,
        144,
        239,
        28,
        114,
        229,
        200,
        95,
        181,
        1,
        0,
        1,
        252,
        158,
        31,
        107,
        235,
        129,
        81,
        101,
        69,
        151,
        82,
        24,
        7,
        94,
        194,
        175,
        17,
        140,
        216,
        121,
        141,
        246,
        224,
        138,
        20,
        124,
        96,
        253,
        96,
        149,
        172,
        43,
        176,
        44,
        41,
        8,
        207,
        77,
        215,
        200,
        31,
        17,
        194,
        137,
        228,
        188,
        233,
        143,
        53,
        83,
        118,
        143,
        57,
        42,
        128,
        206,
        34,
        191,
        92,
        79,
        74,
        36,
        140,
        107
    ]
        .span();
    let expected = array![
        195,
        109,
        128,
        65,
        128,
        195,
        93,
        68,
        38,
        181,
        123,
        80,
        197,
        191,
        204,
        165,
        192,
        24,
        86,
        209,
        4,
        86,
        76,
        213,
        19,
        180,
        97,
        211,
        200,
        184,
        64,
        145,
        40,
        165,
        87,
        62,
        65,
        109,
        14,
        190,
        56,
        245,
        247,
        54,
        118,
        109,
        157,
        194,
        113,
        67,
        228,
        218,
        152,
        29,
        250,
        77,
        103,
        247,
        220,
        71,
        76,
        190,
        230,
        210
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 341;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "nagydani_2_square"
fn test_mod_exp_precompile_7() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        202,
        215,
        217,
        145,
        160,
        0,
        71,
        221,
        84,
        211,
        57,
        155,
        107,
        11,
        147,
        124,
        113,
        138,
        189,
        222,
        247,
        145,
        124,
        117,
        182,
        104,
        31,
        64,
        204,
        21,
        226,
        190,
        0,
        3,
        101,
        125,
        141,
        76,
        52,
        22,
        123,
        47,
        11,
        187,
        202,
        12,
        202,
        164,
        7,
        194,
        166,
        160,
        125,
        80,
        241,
        81,
        122,
        143,
        34,
        151,
        156,
        225,
        42,
        129,
        220,
        175,
        112,
        124,
        192,
        206,
        191,
        192,
        206,
        46,
        232,
        78,
        231,
        247,
        124,
        56,
        185,
        40,
        27,
        152,
        34,
        168,
        211,
        222,
        98,
        120,
        76,
        8,
        156,
        155,
        24,
        220,
        185,
        162,
        165,
        238,
        203,
        237,
        233,
        14,
        167,
        136,
        168,
        98,
        169,
        221,
        217,
        214,
        9,
        194,
        197,
        41,
        114,
        214,
        62,
        40,
        158,
        40,
        246,
        165,
        144,
        255,
        191,
        81,
        2,
        230,
        216,
        147,
        184,
        10,
        238,
        213,
        230,
        233,
        206,
        154,
        250,
        138,
        93,
        86,
        117,
        201,
        58,
        50,
        172,
        5,
        85,
        76,
        178,
        14,
        153,
        81,
        178,
        193,
        64,
        227,
        239,
        78,
        67,
        48,
        104,
        207,
        15,
        183,
        59,
        201,
        243,
        58,
        241,
        133,
        63,
        100,
        170,
        39,
        160,
        2,
        140,
        191,
        87,
        13,
        122,
        201,
        4,
        142,
        174,
        93,
        199,
        178,
        140,
        135,
        195,
        30,
        88,
        16,
        241,
        231,
        250,
        44,
        218,
        106,
        223,
        159,
        16,
        118,
        219,
        193,
        236,
        18,
        56,
        86,
        0,
        113,
        231,
        239,
        196,
        233,
        86,
        92,
        73,
        190,
        158,
        118,
        86,
        149,
        25,
        133,
        134,
        10,
        85,
        138,
        117,
        69,
        148,
        17,
        88,
        48,
        188,
        219,
        66,
        31,
        116,
        20,
        8,
        52,
        109,
        213,
        153,
        123,
        176,
        28,
        40,
        112,
        135
    ]
        .span();
    let expected = array![
        152,
        29,
        217,
        156,
        59,
        17,
        63,
        174,
        62,
        62,
        170,
        148,
        53,
        192,
        220,
        150,
        119,
        154,
        35,
        193,
        42,
        83,
        209,
        8,
        75,
        79,
        103,
        176,
        176,
        83,
        162,
        117,
        96,
        246,
        39,
        184,
        115,
        227,
        241,
        106,
        215,
        143,
        40,
        201,
        79,
        20,
        182,
        57,
        45,
        239,
        38,
        228,
        216,
        137,
        108,
        94,
        60,
        152,
        78,
        80,
        250,
        11,
        58,
        164,
        79,
        29,
        167,
        139,
        145,
        49,
        135,
        198,
        18,
        139,
        170,
        147,
        64,
        177,
        233,
        201,
        160,
        253,
        2,
        203,
        120,
        136,
        94,
        114,
        87,
        109,
        164,
        168,
        247,
        229,
        161,
        19,
        225,
        115,
        167,
        162,
        136,
        159,
        222,
        157,
        64,
        123,
        217,
        240,
        110,
        176,
        91,
        200,
        252,
        123,
        66,
        41,
        55,
        122,
        50,
        148,
        26,
        2,
        191,
        78,
        220,
        192,
        109,
        112
    ]
        .span();

    vm.message.data = calldata;

    let expected_gas = 200;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
// name: "nagydani_2_qube"
fn test_mod_exp_precompile_8() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        202,
        215,
        217,
        145,
        160,
        0,
        71,
        221,
        84,
        211,
        57,
        155,
        107,
        11,
        147,
        124,
        113,
        138,
        189,
        222,
        247,
        145,
        124,
        117,
        182,
        104,
        31,
        64,
        204,
        21,
        226,
        190,
        0,
        3,
        101,
        125,
        141,
        76,
        52,
        22,
        123,
        47,
        11,
        187,
        202,
        12,
        202,
        164,
        7,
        194,
        166,
        160,
        125,
        80,
        241,
        81,
        122,
        143,
        34,
        151,
        156,
        225,
        42,
        129,
        220,
        175,
        112,
        124,
        192,
        206,
        191,
        192,
        206,
        46,
        232,
        78,
        231,
        247,
        124,
        56,
        185,
        40,
        27,
        152,
        34,
        168,
        211,
        222,
        98,
        120,
        76,
        8,
        156,
        155,
        24,
        220,
        185,
        162,
        165,
        238,
        203,
        237,
        233,
        14,
        167,
        136,
        168,
        98,
        169,
        221,
        217,
        214,
        9,
        194,
        197,
        41,
        114,
        214,
        62,
        40,
        158,
        40,
        246,
        165,
        144,
        255,
        191,
        81,
        3,
        230,
        216,
        147,
        184,
        10,
        238,
        213,
        230,
        233,
        206,
        154,
        250,
        138,
        93,
        86,
        117,
        201,
        58,
        50,
        172,
        5,
        85,
        76,
        178,
        14,
        153,
        81,
        178,
        193,
        64,
        227,
        239,
        78,
        67,
        48,
        104,
        207,
        15,
        183,
        59,
        201,
        243,
        58,
        241,
        133,
        63,
        100,
        170,
        39,
        160,
        2,
        140,
        191,
        87,
        13,
        122,
        201,
        4,
        142,
        174,
        93,
        199,
        178,
        140,
        135,
        195,
        30,
        88,
        16,
        241,
        231,
        250,
        44,
        218,
        106,
        223,
        159,
        16,
        118,
        219,
        193,
        236,
        18,
        56,
        86,
        0,
        113,
        231,
        239,
        196,
        233,
        86,
        92,
        73,
        190,
        158,
        118,
        86,
        149,
        25,
        133,
        134,
        10,
        85,
        138,
        117,
        69,
        148,
        17,
        88,
        48,
        188,
        219,
        66,
        31,
        116,
        20,
        8,
        52,
        109,
        213,
        153,
        123,
        176,
        28,
        40,
        112,
        135
    ]
        .span();
    let expected = array![
        216,
        156,
        235,
        104,
        195,
        45,
        164,
        246,
        54,
        73,
        120,
        214,
        42,
        170,
        64,
        215,
        176,
        155,
        89,
        236,
        97,
        235,
        60,
        1,
        89,
        200,
        126,
        195,
        169,
        16,
        55,
        247,
        220,
        105,
        103,
        89,
        78,
        83,
        10,
        105,
        208,
        73,
        182,
        74,
        223,
        163,
        156,
        143,
        162,
        8,
        234,
        151,
        12,
        254,
        75,
        123,
        205,
        53,
        157,
        52,
        87,
        68,
        64,
        90,
        254,
        28,
        191,
        118,
        22,
        71,
        227,
        43,
        49,
        132,
        199,
        251,
        232,
        124,
        238,
        140,
        108,
        127,
        243,
        179,
        120,
        250,
        186,
        108,
        104,
        184,
        59,
        104,
        137,
        203,
        64,
        241,
        96,
        62,
        230,
        140,
        86,
        180,
        192,
        61,
        72,
        197,
        149,
        200,
        38,
        192,
        65,
        17,
        45,
        201,
        65,
        135,
        143,
        140,
        91,
        232,
        40,
        21,
        74,
        253,
        74,
        22,
        49,
        31
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 200;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_1_pow0x10001"
fn test_mod_exp_precompile_9() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        128,
        202,
        215,
        217,
        145,
        160,
        0,
        71,
        221,
        84,
        211,
        57,
        155,
        107,
        11,
        147,
        124,
        113,
        138,
        189,
        222,
        247,
        145,
        124,
        117,
        182,
        104,
        31,
        64,
        204,
        21,
        226,
        190,
        0,
        3,
        101,
        125,
        141,
        76,
        52,
        22,
        123,
        47,
        11,
        187,
        202,
        12,
        202,
        164,
        7,
        194,
        166,
        160,
        125,
        80,
        241,
        81,
        122,
        143,
        34,
        151,
        156,
        225,
        42,
        129,
        220,
        175,
        112,
        124,
        192,
        206,
        191,
        192,
        206,
        46,
        232,
        78,
        231,
        247,
        124,
        56,
        185,
        40,
        27,
        152,
        34,
        168,
        211,
        222,
        98,
        120,
        76,
        8,
        156,
        155,
        24,
        220,
        185,
        162,
        165,
        238,
        203,
        237,
        233,
        14,
        167,
        136,
        168,
        98,
        169,
        221,
        217,
        214,
        9,
        194,
        197,
        41,
        114,
        214,
        62,
        40,
        158,
        40,
        246,
        165,
        144,
        255,
        191,
        81,
        1,
        0,
        1,
        230,
        216,
        147,
        184,
        10,
        238,
        213,
        230,
        233,
        206,
        154,
        250,
        138,
        93,
        86,
        117,
        201,
        58,
        50,
        172,
        5,
        85,
        76,
        178,
        14,
        153,
        81,
        178,
        193,
        64,
        227,
        239,
        78,
        67,
        48,
        104,
        207,
        15,
        183,
        59,
        201,
        243,
        58,
        241,
        133,
        63,
        100,
        170,
        39,
        160,
        2,
        140,
        191,
        87,
        13,
        122,
        201,
        4,
        142,
        174,
        93,
        199,
        178,
        140,
        135,
        195,
        30,
        88,
        16,
        241,
        231,
        250,
        44,
        218,
        106,
        223,
        159,
        16,
        118,
        219,
        193,
        236,
        18,
        56,
        86,
        0,
        113,
        231,
        239,
        196,
        233,
        86,
        92,
        73,
        190,
        158,
        118,
        86,
        149,
        25,
        133,
        134,
        10,
        85,
        138,
        117,
        69,
        148,
        17,
        88,
        48,
        188,
        219,
        66,
        31,
        116,
        20,
        8,
        52,
        109,
        213,
        153,
        123,
        176,
        28,
        40,
        112,
        135
    ]
        .span();
    let expected = array![
        173,
        133,
        232,
        239,
        19,
        253,
        29,
        212,
        110,
        174,
        68,
        175,
        139,
        145,
        173,
        28,
        202,
        229,
        183,
        161,
        201,
        41,
        68,
        249,
        42,
        25,
        242,
        27,
        11,
        101,
        129,
        57,
        224,
        202,
        190,
        156,
        31,
        103,
        149,
        7,
        194,
        222,
        53,
        75,
        242,
        201,
        30,
        189,
        150,
        93,
        30,
        99,
        57,
        120,
        168,
        48,
        213,
        23,
        210,
        246,
        248,
        221,
        95,
        213,
        128,
        101,
        213,
        133,
        89,
        222,
        126,
        35,
        52,
        168,
        120,
        248,
        236,
        105,
        146,
        217,
        185,
        231,
        116,
        48,
        212,
        118,
        78,
        134,
        61,
        119,
        192,
        248,
        123,
        238,
        222,
        143,
        47,
        127,
        42,
        178,
        231,
        34,
        47,
        133,
        204,
        157,
        152,
        184,
        70,
        127,
        75,
        183,
        46,
        135,
        239,
        40,
        130,
        66,
        62,
        189,
        182,
        218,
        240,
        45,
        221,
        172,
        109,
        178
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 1365;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_2_square"
fn test_mod_exp_precompile_10() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        201,
        19,
        5,
        121,
        242,
        67,
        225,
        36,
        81,
        118,
        9,
        118,
        38,
        20,
        22,
        65,
        55,
        66,
        189,
        124,
        145,
        211,
        154,
        224,
        135,
        244,
        103,
        148,
        6,
        43,
        140,
        35,
        159,
        42,
        116,
        171,
        243,
        145,
        134,
        5,
        160,
        224,
        70,
        167,
        137,
        14,
        4,
        148,
        117,
        186,
        127,
        187,
        120,
        245,
        222,
        100,
        144,
        189,
        34,
        167,
        16,
        204,
        4,
        211,
        0,
        136,
        23,
        154,
        145,
        157,
        134,
        194,
        218,
        98,
        207,
        55,
        245,
        157,
        143,
        37,
        141,
        35,
        16,
        217,
        76,
        36,
        137,
        27,
        226,
        215,
        238,
        175,
        170,
        50,
        168,
        203,
        75,
        12,
        254,
        95,
        71,
        94,
        215,
        120,
        244,
        89,
        7,
        220,
        137,
        22,
        167,
        63,
        3,
        99,
        95,
        35,
        63,
        122,
        119,
        160,
        10,
        62,
        201,
        202,
        103,
        97,
        165,
        187,
        213,
        88,
        162,
        49,
        142,
        205,
        12,
        170,
        28,
        80,
        22,
        105,
        21,
        35,
        231,
        225,
        250,
        38,
        125,
        211,
        94,
        112,
        198,
        110,
        132,
        56,
        11,
        220,
        247,
        192,
        88,
        47,
        84,
        1,
        116,
        229,
        114,
        196,
        31,
        129,
        233,
        61,
        160,
        183,
        87,
        223,
        240,
        176,
        254,
        35,
        235,
        3,
        170,
        25,
        175,
        11,
        222,
        195,
        175,
        180,
        116,
        33,
        111,
        235,
        170,
        203,
        141,
        3,
        129,
        230,
        49,
        128,
        38,
        131,
        24,
        43,
        15,
        231,
        44,
        40,
        57,
        37,
        57,
        133,
        6,
        80,
        183,
        5,
        9,
        245,
        73,
        128,
        36,
        29,
        193,
        117,
        25,
        26,
        53,
        217,
        103,
        40,
        139,
        83,
        42,
        122,
        130,
        35,
        206,
        36,
        64,
        208,
        16,
        97,
        95,
        112,
        223,
        38,
        149,
        1,
        148,
        77,
        78,
        193,
        111,
        228,
        163,
        203,
        2,
        215,
        168,
        89,
        9,
        23,
        71,
        87,
        131,
        81,
        135,
        203,
        82,
        231,
        25,
        52,
        230,
        192,
        126,
        244,
        59,
        76,
        70,
        252,
        48,
        187,
        205,
        11,
        199,
        41,
        19,
        6,
        130,
        103,
        197,
        74,
        74,
        171,
        235,
        180,
        147,
        146,
        36,
        146,
        130,
        11,
        171,
        222,
        183,
        220,
        155,
        21,
        88,
        252,
        247,
        189,
        130,
        195,
        124,
        130,
        211,
        20,
        126,
        69,
        91,
        98,
        58,
        176,
        239,
        167,
        82,
        254,
        11,
        58,
        103,
        202,
        110,
        77,
        18,
        102,
        57,
        230,
        69,
        160,
        191,
        65,
        117,
        104,
        173,
        187,
        42,
        106,
        78,
        239,
        98,
        250,
        31,
        162,
        155,
        42,
        90,
        67,
        190,
        190,
        161,
        248,
        33,
        147,
        167,
        221,
        152,
        235,
        72,
        61,
        9,
        187,
        89,
        90,
        241,
        250,
        156,
        151,
        199,
        244,
        31,
        86,
        73,
        217,
        118,
        174,
        227,
        229,
        229,
        158,
        35,
        41,
        180,
        59,
        19,
        190,
        162,
        40,
        212,
        169,
        63,
        22,
        186,
        19,
        156,
        203,
        81,
        29,
        229,
        33,
        255,
        231,
        71,
        170,
        46,
        202,
        102,
        79,
        124,
        158,
        51,
        218,
        89,
        7,
        92,
        195,
        53,
        175,
        205,
        43,
        243,
        174,
        9,
        118,
        95,
        1,
        171,
        90,
        124,
        62,
        57,
        56,
        236,
        22,
        139,
        116,
        114,
        75,
        80,
        116,
        36,
        125,
        32,
        13,
        153,
        112,
        56,
        47,
        104,
        61,
        96,
        89,
        185,
        77,
        188,
        51,
        102,
        3,
        209,
        223,
        238,
        113,
        78,
        75,
        68,
        122,
        194,
        250,
        29,
        153,
        236,
        180,
        150,
        29,
        162,
        133,
        78,
        3,
        121,
        94,
        215,
        88,
        34,
        3,
        18,
        209,
        1,
        225,
        227,
        216,
        125,
        83,
        19,
        166,
        208,
        82,
        174,
        189,
        231,
        81,
        16,
        54,
        61
    ]
        .span();
    let expected = array![
        175,
        252,
        117,
        7,
        234,
        109,
        132,
        117,
        30,
        198,
        179,
        240,
        215,
        185,
        157,
        188,
        194,
        99,
        243,
        51,
        48,
        228,
        80,
        209,
        179,
        255,
        11,
        195,
        208,
        135,
        67,
        32,
        191,
        78,
        221,
        87,
        222,
        189,
        88,
        115,
        6,
        152,
        129,
        87,
        149,
        140,
        179,
        207,
        211,
        105,
        204,
        12,
        156,
        25,
        135,
        6,
        246,
        53,
        201,
        224,
        241,
        93,
        4,
        125,
        245,
        203,
        68,
        208,
        62,
        39,
        39,
        242,
        107,
        8,
        60,
        74,
        216,
        72,
        80,
        128,
        225,
        41,
        63,
        23,
        28,
        30,
        213,
        42,
        239,
        89,
        147,
        165,
        129,
        92,
        53,
        16,
        142,
        132,
        140,
        149,
        28,
        241,
        227,
        52,
        73,
        11,
        74,
        83,
        154,
        19,
        158,
        87,
        182,
        143,
        68,
        254,
        229,
        131,
        48,
        111,
        91,
        133,
        255,
        165,
        114,
        6,
        179,
        238,
        86,
        96,
        69,
        136,
        88,
        83,
        78,
        83,
        134,
        185,
        88,
        74,
        243,
        199,
        246,
        120,
        6,
        232,
        76,
        24,
        157,
        105,
        94,
        94,
        185,
        110,
        18,
        114,
        208,
        110,
        194,
        223,
        93,
        197,
        250,
        188,
        110,
        148,
        183,
        147,
        113,
        140,
        96,
        195,
        107,
        224,
        164,
        208,
        49,
        252,
        132,
        205,
        101,
        138,
        167,
        34,
        148,
        178,
        225,
        111,
        194,
        64,
        174,
        247,
        12,
        185,
        229,
        145,
        36,
        142,
        56,
        189,
        73,
        197,
        165,
        84,
        209,
        175,
        160,
        31,
        56,
        218,
        183,
        39,
        51,
        9,
        47,
        117,
        85,
        51,
        75,
        190,
        246,
        200,
        196,
        48,
        17,
        152,
        64,
        73,
        35,
        128,
        170,
        149,
        250,
        2,
        93,
        207,
        105,
        159,
        10,
        57,
        102,
        157,
        129,
        43,
        12,
        105,
        70,
        182,
        9,
        30,
        110,
        35,
        83,
        55,
        182,
        248
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 341;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_2_qube"
fn test_mod_exp_precompile_11() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        201,
        19,
        5,
        121,
        242,
        67,
        225,
        36,
        81,
        118,
        9,
        118,
        38,
        20,
        22,
        65,
        55,
        66,
        189,
        124,
        145,
        211,
        154,
        224,
        135,
        244,
        103,
        148,
        6,
        43,
        140,
        35,
        159,
        42,
        116,
        171,
        243,
        145,
        134,
        5,
        160,
        224,
        70,
        167,
        137,
        14,
        4,
        148,
        117,
        186,
        127,
        187,
        120,
        245,
        222,
        100,
        144,
        189,
        34,
        167,
        16,
        204,
        4,
        211,
        0,
        136,
        23,
        154,
        145,
        157,
        134,
        194,
        218,
        98,
        207,
        55,
        245,
        157,
        143,
        37,
        141,
        35,
        16,
        217,
        76,
        36,
        137,
        27,
        226,
        215,
        238,
        175,
        170,
        50,
        168,
        203,
        75,
        12,
        254,
        95,
        71,
        94,
        215,
        120,
        244,
        89,
        7,
        220,
        137,
        22,
        167,
        63,
        3,
        99,
        95,
        35,
        63,
        122,
        119,
        160,
        10,
        62,
        201,
        202,
        103,
        97,
        165,
        187,
        213,
        88,
        162,
        49,
        142,
        205,
        12,
        170,
        28,
        80,
        22,
        105,
        21,
        35,
        231,
        225,
        250,
        38,
        125,
        211,
        94,
        112,
        198,
        110,
        132,
        56,
        11,
        220,
        247,
        192,
        88,
        47,
        84,
        1,
        116,
        229,
        114,
        196,
        31,
        129,
        233,
        61,
        160,
        183,
        87,
        223,
        240,
        176,
        254,
        35,
        235,
        3,
        170,
        25,
        175,
        11,
        222,
        195,
        175,
        180,
        116,
        33,
        111,
        235,
        170,
        203,
        141,
        3,
        129,
        230,
        49,
        128,
        38,
        131,
        24,
        43,
        15,
        231,
        44,
        40,
        57,
        37,
        57,
        133,
        6,
        80,
        183,
        5,
        9,
        245,
        73,
        128,
        36,
        29,
        193,
        117,
        25,
        26,
        53,
        217,
        103,
        40,
        139,
        83,
        42,
        122,
        130,
        35,
        206,
        36,
        64,
        208,
        16,
        97,
        95,
        112,
        223,
        38,
        149,
        1,
        148,
        77,
        78,
        193,
        111,
        228,
        163,
        203,
        3,
        215,
        168,
        89,
        9,
        23,
        71,
        87,
        131,
        81,
        135,
        203,
        82,
        231,
        25,
        52,
        230,
        192,
        126,
        244,
        59,
        76,
        70,
        252,
        48,
        187,
        205,
        11,
        199,
        41,
        19,
        6,
        130,
        103,
        197,
        74,
        74,
        171,
        235,
        180,
        147,
        146,
        36,
        146,
        130,
        11,
        171,
        222,
        183,
        220,
        155,
        21,
        88,
        252,
        247,
        189,
        130,
        195,
        124,
        130,
        211,
        20,
        126,
        69,
        91,
        98,
        58,
        176,
        239,
        167,
        82,
        254,
        11,
        58,
        103,
        202,
        110,
        77,
        18,
        102,
        57,
        230,
        69,
        160,
        191,
        65,
        117,
        104,
        173,
        187,
        42,
        106,
        78,
        239,
        98,
        250,
        31,
        162,
        155,
        42,
        90,
        67,
        190,
        190,
        161,
        248,
        33,
        147,
        167,
        221,
        152,
        235,
        72,
        61,
        9,
        187,
        89,
        90,
        241,
        250,
        156,
        151,
        199,
        244,
        31,
        86,
        73,
        217,
        118,
        174,
        227,
        229,
        229,
        158,
        35,
        41,
        180,
        59,
        19,
        190,
        162,
        40,
        212,
        169,
        63,
        22,
        186,
        19,
        156,
        203,
        81,
        29,
        229,
        33,
        255,
        231,
        71,
        170,
        46,
        202,
        102,
        79,
        124,
        158,
        51,
        218,
        89,
        7,
        92,
        195,
        53,
        175,
        205,
        43,
        243,
        174,
        9,
        118,
        95,
        1,
        171,
        90,
        124,
        62,
        57,
        56,
        236,
        22,
        139,
        116,
        114,
        75,
        80,
        116,
        36,
        125,
        32,
        13,
        153,
        112,
        56,
        47,
        104,
        61,
        96,
        89,
        185,
        77,
        188,
        51,
        102,
        3,
        209,
        223,
        238,
        113,
        78,
        75,
        68,
        122,
        194,
        250,
        29,
        153,
        236,
        180,
        150,
        29,
        162,
        133,
        78,
        3,
        121,
        94,
        215,
        88,
        34,
        3,
        18,
        209,
        1,
        225,
        227,
        216,
        125,
        83,
        19,
        166,
        208,
        82,
        174,
        189,
        231,
        81,
        16,
        54,
        61
    ]
        .span();
    let expected = array![
        27,
        40,
        14,
        205,
        106,
        107,
        249,
        6,
        184,
        6,
        213,
        39,
        194,
        168,
        49,
        226,
        59,
        35,
        143,
        137,
        218,
        72,
        68,
        144,
        3,
        168,
        138,
        195,
        172,
        113,
        80,
        214,
        165,
        233,
        230,
        179,
        190,
        64,
        84,
        199,
        218,
        17,
        221,
        30,
        71,
        14,
        194,
        154,
        96,
        111,
        81,
        21,
        128,
        27,
        91,
        245,
        59,
        193,
        144,
        2,
        113,
        215,
        195,
        255,
        60,
        213,
        237,
        121,
        13,
        28,
        33,
        154,
        152,
        0,
        67,
        122,
        104,
        159,
        35,
        136,
        186,
        26,
        17,
        214,
        143,
        106,
        142,
        91,
        116,
        233,
        163,
        177,
        250,
        198,
        238,
        133,
        252,
        106,
        251,
        172,
        89,
        159,
        147,
        195,
        145,
        245,
        220,
        130,
        167,
        89,
        227,
        198,
        192,
        171,
        69,
        206,
        63,
        93,
        37,
        217,
        176,
        193,
        191,
        148,
        207,
        112,
        30,
        166,
        70,
        111,
        201,
        164,
        120,
        218,
        204,
        87,
        84,
        229,
        147,
        23,
        43,
        81,
        17,
        238,
        186,
        136,
        85,
        112,
        72,
        188,
        234,
        228,
        1,
        51,
        124,
        212,
        193,
        24,
        42,
        217,
        247,
        0,
        133,
        43,
        200,
        201,
        153,
        51,
        161,
        147,
        240,
        185,
        76,
        241,
        174,
        219,
        239,
        196,
        139,
        227,
        188,
        147,
        239,
        92,
        178,
        118,
        215,
        194,
        213,
        70,
        42,
        200,
        187,
        12,
        143,
        232,
        146,
        58,
        29,
        178,
        175,
        225,
        198,
        185,
        13,
        89,
        197,
        52,
        153,
        74,
        106,
        99,
        63,
        14,
        173,
        29,
        99,
        143,
        220,
        41,
        52,
        134,
        187,
        99,
        79,
        242,
        200,
        236,
        158,
        114,
        151,
        192,
        66,
        65,
        166,
        28,
        55,
        227,
        174,
        149,
        177,
        29,
        83,
        52,
        61,
        75,
        162,
        180,
        204,
        51,
        210,
        207,
        167,
        235,
        112,
        94
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 341;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_2_pow0x10001"
fn test_mod_exp_precompile_12() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        201,
        19,
        5,
        121,
        242,
        67,
        225,
        36,
        81,
        118,
        9,
        118,
        38,
        20,
        22,
        65,
        55,
        66,
        189,
        124,
        145,
        211,
        154,
        224,
        135,
        244,
        103,
        148,
        6,
        43,
        140,
        35,
        159,
        42,
        116,
        171,
        243,
        145,
        134,
        5,
        160,
        224,
        70,
        167,
        137,
        14,
        4,
        148,
        117,
        186,
        127,
        187,
        120,
        245,
        222,
        100,
        144,
        189,
        34,
        167,
        16,
        204,
        4,
        211,
        0,
        136,
        23,
        154,
        145,
        157,
        134,
        194,
        218,
        98,
        207,
        55,
        245,
        157,
        143,
        37,
        141,
        35,
        16,
        217,
        76,
        36,
        137,
        27,
        226,
        215,
        238,
        175,
        170,
        50,
        168,
        203,
        75,
        12,
        254,
        95,
        71,
        94,
        215,
        120,
        244,
        89,
        7,
        220,
        137,
        22,
        167,
        63,
        3,
        99,
        95,
        35,
        63,
        122,
        119,
        160,
        10,
        62,
        201,
        202,
        103,
        97,
        165,
        187,
        213,
        88,
        162,
        49,
        142,
        205,
        12,
        170,
        28,
        80,
        22,
        105,
        21,
        35,
        231,
        225,
        250,
        38,
        125,
        211,
        94,
        112,
        198,
        110,
        132,
        56,
        11,
        220,
        247,
        192,
        88,
        47,
        84,
        1,
        116,
        229,
        114,
        196,
        31,
        129,
        233,
        61,
        160,
        183,
        87,
        223,
        240,
        176,
        254,
        35,
        235,
        3,
        170,
        25,
        175,
        11,
        222,
        195,
        175,
        180,
        116,
        33,
        111,
        235,
        170,
        203,
        141,
        3,
        129,
        230,
        49,
        128,
        38,
        131,
        24,
        43,
        15,
        231,
        44,
        40,
        57,
        37,
        57,
        133,
        6,
        80,
        183,
        5,
        9,
        245,
        73,
        128,
        36,
        29,
        193,
        117,
        25,
        26,
        53,
        217,
        103,
        40,
        139,
        83,
        42,
        122,
        130,
        35,
        206,
        36,
        64,
        208,
        16,
        97,
        95,
        112,
        223,
        38,
        149,
        1,
        148,
        77,
        78,
        193,
        111,
        228,
        163,
        203,
        1,
        0,
        1,
        215,
        168,
        89,
        9,
        23,
        71,
        87,
        131,
        81,
        135,
        203,
        82,
        231,
        25,
        52,
        230,
        192,
        126,
        244,
        59,
        76,
        70,
        252,
        48,
        187,
        205,
        11,
        199,
        41,
        19,
        6,
        130,
        103,
        197,
        74,
        74,
        171,
        235,
        180,
        147,
        146,
        36,
        146,
        130,
        11,
        171,
        222,
        183,
        220,
        155,
        21,
        88,
        252,
        247,
        189,
        130,
        195,
        124,
        130,
        211,
        20,
        126,
        69,
        91,
        98,
        58,
        176,
        239,
        167,
        82,
        254,
        11,
        58,
        103,
        202,
        110,
        77,
        18,
        102,
        57,
        230,
        69,
        160,
        191,
        65,
        117,
        104,
        173,
        187,
        42,
        106,
        78,
        239,
        98,
        250,
        31,
        162,
        155,
        42,
        90,
        67,
        190,
        190,
        161,
        248,
        33,
        147,
        167,
        221,
        152,
        235,
        72,
        61,
        9,
        187,
        89,
        90,
        241,
        250,
        156,
        151,
        199,
        244,
        31,
        86,
        73,
        217,
        118,
        174,
        227,
        229,
        229,
        158,
        35,
        41,
        180,
        59,
        19,
        190,
        162,
        40,
        212,
        169,
        63,
        22,
        186,
        19,
        156,
        203,
        81,
        29,
        229,
        33,
        255,
        231,
        71,
        170,
        46,
        202,
        102,
        79,
        124,
        158,
        51,
        218,
        89,
        7,
        92,
        195,
        53,
        175,
        205,
        43,
        243,
        174,
        9,
        118,
        95,
        1,
        171,
        90,
        124,
        62,
        57,
        56,
        236,
        22,
        139,
        116,
        114,
        75,
        80,
        116,
        36,
        125,
        32,
        13,
        153,
        112,
        56,
        47,
        104,
        61,
        96,
        89,
        185,
        77,
        188,
        51,
        102,
        3,
        209,
        223,
        238,
        113,
        78,
        75,
        68,
        122,
        194,
        250,
        29,
        153,
        236,
        180,
        150,
        29,
        162,
        133,
        78,
        3,
        121,
        94,
        215,
        88,
        34,
        3,
        18,
        209,
        1,
        225,
        227,
        216,
        125,
        83,
        19,
        166,
        208,
        82,
        174,
        189,
        231,
        81,
        16,
        54,
        61
    ]
        .span();
    let expected = array![
        55,
        132,
        61,
        124,
        103,
        146,
        11,
        95,
        23,
        115,
        114,
        250,
        86,
        226,
        160,
        145,
        23,
        223,
        88,
        95,
        129,
        223,
        139,
        48,
        15,
        186,
        36,
        91,
        17,
        117,
        244,
        136,
        201,
        148,
        118,
        1,
        152,
        87,
        25,
        142,
        212,
        89,
        237,
        141,
        151,
        153,
        195,
        119,
        51,
        14,
        73,
        244,
        24,
        12,
        75,
        248,
        232,
        246,
        98,
        64,
        198,
        79,
        101,
        237,
        233,
        61,
        96,
        31,
        149,
        123,
        149,
        184,
        62,
        253,
        238,
        30,
        27,
        253,
        231,
        65,
        105,
        255,
        119,
        0,
        46,
        175,
        7,
        140,
        113,
        129,
        90,
        146,
        32,
        200,
        11,
        46,
        59,
        63,
        242,
        44,
        47,
        53,
        129,
        17,
        216,
        22,
        235,
        248,
        60,
        41,
        153,
        2,
        107,
        109,
        229,
        11,
        252,
        113,
        31,
        246,
        135,
        5,
        210,
        244,
        11,
        117,
        52,
        36,
        174,
        252,
        159,
        112,
        240,
        141,
        144,
        139,
        90,
        32,
        39,
        106,
        214,
        19,
        180,
        171,
        67,
        9,
        163,
        234,
        114,
        240,
        193,
        126,
        169,
        223,
        107,
        51,
        103,
        212,
        79,
        179,
        172,
        171,
        17,
        195,
        51,
        144,
        158,
        2,
        232,
        30,
        162,
        237,
        64,
        74,
        113,
        45,
        62,
        169,
        107,
        186,
        135,
        70,
        23,
        32,
        226,
        217,
        135,
        35,
        231,
        172,
        208,
        82,
        10,
        193,
        165,
        33,
        45,
        190,
        220,
        216,
        220,
        12,
        26,
        191,
        97,
        212,
        113,
        158,
        49,
        159,
        244,
        117,
        138,
        119,
        71,
        144,
        184,
        212,
        99,
        205,
        254,
        19,
        29,
        27,
        45,
        207,
        238,
        82,
        208,
        2,
        105,
        78,
        152,
        231,
        32,
        203,
        106,
        231,
        204,
        234,
        53,
        59,
        197,
        3,
        38,
        155,
        163,
        95,
        15,
        99,
        191,
        141,
        123,
        103,
        42,
        118
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 5461;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_3_square"
fn test_mod_exp_precompile_13() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        219,
        52,
        208,
        228,
        56,
        36,
        156,
        14,
        214,
        133,
        201,
        73,
        204,
        40,
        119,
        106,
        5,
        9,
        78,
        28,
        72,
        105,
        29,
        195,
        242,
        220,
        165,
        252,
        51,
        86,
        210,
        160,
        102,
        59,
        211,
        118,
        228,
        113,
        40,
        57,
        145,
        126,
        185,
        161,
        156,
        103,
        4,
        7,
        226,
        195,
        119,
        162,
        222,
        56,
        90,
        63,
        243,
        181,
        33,
        4,
        247,
        241,
        244,
        224,
        199,
        191,
        119,
        23,
        251,
        145,
        56,
        150,
        105,
        61,
        197,
        237,
        187,
        101,
        183,
        96,
        239,
        27,
        0,
        228,
        46,
        157,
        143,
        154,
        241,
        115,
        82,
        56,
        94,
        28,
        215,
        66,
        201,
        176,
        6,
        192,
        246,
        105,
        153,
        92,
        176,
        187,
        33,
        210,
        140,
        10,
        206,
        210,
        137,
        34,
        103,
        99,
        123,
        100,
        112,
        216,
        206,
        224,
        171,
        39,
        252,
        93,
        66,
        101,
        143,
        110,
        136,
        36,
        12,
        49,
        214,
        119,
        74,
        166,
        10,
        126,
        189,
        37,
        205,
        72,
        181,
        109,
        13,
        161,
        18,
        9,
        241,
        146,
        142,
        97,
        0,
        92,
        110,
        183,
        9,
        243,
        232,
        224,
        170,
        248,
        217,
        177,
        15,
        125,
        126,
        41,
        109,
        119,
        34,
        100,
        220,
        118,
        137,
        124,
        205,
        221,
        173,
        201,
        30,
        250,
        145,
        193,
        144,
        59,
        114,
        50,
        169,
        228,
        195,
        185,
        65,
        145,
        123,
        153,
        163,
        188,
        12,
        38,
        73,
        125,
        237,
        200,
        151,
        194,
        87,
        80,
        175,
        96,
        35,
        122,
        166,
        121,
        52,
        162,
        106,
        43,
        196,
        145,
        219,
        61,
        204,
        103,
        116,
        145,
        148,
        75,
        193,
        245,
        29,
        62,
        93,
        118,
        184,
        216,
        70,
        166,
        45,
        176,
        61,
        237,
        214,
        31,
        245,
        8,
        249,
        26,
        86,
        215,
        16,
        40,
        18,
        80,
        53,
        195,
        164,
        76,
        187,
        4,
        20,
        151,
        200,
        59,
        243,
        228,
        174,
        42,
        150,
        19,
        164,
        1,
        204,
        114,
        28,
        84,
        122,
        42,
        250,
        59,
        22,
        162,
        150,
        153,
        51,
        211,
        98,
        110,
        214,
        216,
        167,
        66,
        134,
        72,
        247,
        65,
        34,
        253,
        63,
        42,
        2,
        162,
        7,
        88,
        247,
        246,
        147,
        137,
        44,
        143,
        215,
        152,
        179,
        154,
        186,
        192,
        29,
        24,
        80,
        108,
        69,
        231,
        20,
        50,
        99,
        158,
        159,
        149,
        5,
        113,
        158,
        232,
        34,
        246,
        44,
        203,
        244,
        127,
        104,
        80,
        240,
        150,
        255,
        119,
        181,
        175,
        175,
        75,
        231,
        215,
        114,
        2,
        87,
        145,
        113,
        125,
        190,
        90,
        191,
        155,
        63,
        64,
        207,
        247,
        215,
        170,
        182,
        246,
        126,
        56,
        246,
        47,
        175,
        81,
        7,
        71,
        39,
        110,
        32,
        164,
        33,
        39,
        231,
        80,
        12,
        68,
        79,
        158,
        217,
        43,
        175,
        101,
        173,
        233,
        232,
        54,
        132,
        94,
        57,
        196,
        49,
        109,
        157,
        206,
        95,
        142,
        44,
        128,
        131,
        226,
        192,
        172,
        187,
        149,
        41,
        110,
        5,
        229,
        26,
        171,
        19,
        182,
        184,
        245,
        63,
        6,
        201,
        196,
        39,
        110,
        18,
        176,
        103,
        17,
        51,
        33,
        140,
        195,
        234,
        144,
        125,
        163,
        189,
        154,
        54,
        112,
        150,
        217,
        32,
        33,
        40,
        209,
        72,
        70,
        204,
        46,
        32,
        213,
        111,
        200,
        71,
        62,
        203,
        7,
        206,
        203,
        251,
        128,
        134,
        145,
        159,
        57,
        113,
        146,
        110,
        112,
        69,
        184,
        83,
        216,
        90,
        105,
        208,
        38,
        25,
        92,
        112,
        249,
        247,
        168,
        35,
        83,
        110,
        42,
        143,
        75,
        62,
        18,
        233,
        77,
        155,
        83,
        169,
        52,
        53,
        52,
        81,
        9,
        75,
        129,
        2,
        223,
        49,
        67,
        160,
        5,
        116,
        87,
        215,
        94,
        140,
        112,
        139,
        99,
        55,
        166,
        245,
        164,
        253,
        26,
        6,
        114,
        122,
        207,
        159,
        185,
        62,
        41,
        147,
        198,
        47,
        51,
        120,
        179,
        125,
        86,
        200,
        94,
        123,
        30,
        0,
        240,
        20,
        94,
        191,
        142,
        64,
        149,
        189,
        114,
        49,
        102,
        41,
        60,
        96,
        182,
        172,
        18,
        82,
        41,
        30,
        246,
        88,
        35,
        201,
        224,
        64,
        221,
        173,
        20,
        150,
        155,
        59,
        52,
        10,
        78,
        247,
        20,
        219,
        9,
        58,
        88,
        124,
        55,
        118,
        109,
        104,
        184,
        214,
        181,
        1,
        110,
        116,
        21,
        135,
        231,
        230,
        191,
        126,
        118,
        59,
        68,
        240,
        36,
        126,
        100,
        186,
        227,
        15,
        153,
        77,
        36,
        139,
        253,
        32,
        84,
        26,
        51,
        62,
        91,
        34,
        94,
        246,
        166,
        17,
        153,
        227,
        1,
        115,
        139,
        30,
        104,
        143,
        112,
        236,
        29,
        127,
        184,
        146,
        193,
        131,
        201,
        93,
        197,
        67,
        195,
        225,
        42,
        223,
        138,
        94,
        139,
        156,
        169,
        208,
        79,
        148,
        69,
        204,
        237,
        58,
        178,
        86,
        242,
        158,
        153,
        142,
        105,
        239,
        170,
        99,
        58,
        123,
        96,
        225,
        219,
        90,
        134,
        121,
        36,
        204,
        171,
        10,
        23,
        29,
        157,
        110,
        16,
        152,
        223,
        161,
        90,
        205,
        233,
        85,
        61,
        229,
        153,
        234,
        165,
        100,
        144,
        200,
        244,
        17,
        228,
        152,
        81,
        17,
        243,
        212,
        11,
        221,
        252,
        94,
        48,
        30,
        219,
        1,
        84,
        123,
        1,
        168,
        134,
        85,
        10,
        97,
        21,
        143,
        126,
        32,
        51,
        197,
        151,
        7,
        120,
        155,
        247,
        200,
        84,
        24,
        29,
        12,
        46,
        42,
        66,
        169,
        60,
        240,
        146,
        9,
        116,
        125,
        112,
        130,
        225,
        71,
        235,
        133,
        68,
        222,
        37,
        195,
        235,
        20,
        242,
        227,
        85,
        89,
        234,
        12,
        15,
        88,
        119,
        242,
        243,
        252,
        146,
        19,
        44,
        10,
        233,
        218,
        78,
        69,
        178,
        246,
        200,
        102,
        162,
        36,
        234,
        109,
        31,
        40,
        192,
        83,
        32,
        226,
        135,
        117,
        15,
        188,
        100,
        115,
        104,
        212,
        17,
        22,
        229,
        40,
        1,
        76,
        193,
        133,
        46,
        85,
        49,
        213,
        62,
        74,
        249,
        56,
        55,
        77,
        171,
        166,
        206,
        228,
        186,
        168,
        33,
        237,
        7,
        17,
        114,
        83,
        187,
        54,
        1,
        221,
        208,
        13,
        89,
        163,
        215,
        251,
        46,
        241,
        245,
        162,
        251,
        186,
        124,
        66,
        159,
        12,
        249,
        165,
        179,
        70,
        36,
        16,
        253,
        131,
        58,
        105,
        17,
        143,
        139,
        233,
        197,
        89,
        177,
        0,
        12,
        198,
        8,
        253,
        135,
        127,
        180,
        63,
        142,
        101,
        194,
        209,
        48,
        38,
        34,
        185,
        68,
        70,
        37,
        121,
        5,
        104,
        116,
        179,
        135,
        32,
        141,
        144,
        98,
        63,
        205,
        175,
        147,
        146,
        12,
        167,
        169,
        228,
        186,
        100,
        234,
        32,
        135,
        88,
        34,
        42,
        216,
        104,
        80,
        28,
        194,
        195,
        69,
        226,
        211,
        165,
        234,
        42,
        23,
        229,
        6,
        146,
        72,
        19,
        140,
        138,
        121,
        192,
        37,
        17,
        133,
        210,
        158,
        231,
        62,
        90,
        250,
        181,
        53,
        71,
        105,
        20,
        45,
        43,
        240,
        203,
        103,
        18,
        114,
        122,
        166,
        191,
        132,
        166,
        36,
        95,
        205,
        174,
        102,
        228,
        147,
        141,
        132,
        209,
        185,
        221,
        9,
        168,
        132,
        129,
        134,
        34,
        8,
        15,
        245,
        249,
        137,
        66,
        251,
        32,
        172,
        215,
        224,
        201,
        22,
        194,
        213,
        234,
        124,
        230,
        247,
        225,
        115,
        49,
        83,
        132,
        81,
        143
    ]
        .span();
    let expected = array![
        138,
        90,
        234,
        95,
        80,
        220,
        192,
        61,
        199,
        167,
        162,
        114,
        181,
        174,
        235,
        192,
        64,
        85,
        77,
        188,
        31,
        254,
        54,
        117,
        60,
        79,
        199,
        95,
        126,
        213,
        246,
        194,
        204,
        13,
        227,
        169,
        34,
        191,
        150,
        199,
        139,
        240,
        100,
        58,
        115,
        2,
        90,
        210,
        31,
        69,
        164,
        165,
        202,
        221,
        113,
        118,
        18,
        197,
        17,
        171,
        43,
        255,
        17,
        144,
        254,
        95,
        26,
        224,
        91,
        169,
        248,
        254,
        54,
        36,
        222,
        29,
        226,
        168,
        23,
        218,
        96,
        114,
        221,
        205,
        185,
        51,
        181,
        2,
        22,
        129,
        29,
        190,
        106,
        156,
        167,
        157,
        58,
        60,
        107,
        58,
        71,
        107,
        7,
        159,
        208,
        208,
        95,
        4,
        251,
        21,
        78,
        45,
        211,
        229,
        203,
        131,
        177,
        72,
        160,
        6,
        242,
        188,
        191,
        0,
        66,
        239,
        178,
        174,
        123,
        145,
        110,
        168,
        27,
        39,
        170,
        194,
        92,
        59,
        249,
        168,
        182,
        211,
        84,
        64,
        6,
        42,
        216,
        234,
        227,
        74,
        131,
        243,
        255,
        162,
        204,
        123,
        64,
        52,
        107,
        98,
        23,
        74,
        68,
        34,
        88,
        79,
        114,
        249,
        83,
        22,
        246,
        178,
        190,
        233,
        255,
        35,
        43,
        169,
        115,
        147,
        1,
        201,
        124,
        153,
        169,
        222,
        210,
        108,
        69,
        215,
        38,
        118,
        235,
        133,
        106,
        214,
        236,
        200,
        29,
        54,
        166,
        222,
        54,
        215,
        249,
        218,
        250,
        254,
        225,
        27,
        170,
        67,
        164,
        176,
        213,
        228,
        236,
        255,
        167,
        185,
        183,
        220,
        239,
        213,
        140,
        57,
        125,
        211,
        115,
        230,
        219,
        74,
        205,
        43,
        44,
        2,
        113,
        119,
        18,
        230,
        40,
        155,
        237,
        124,
        129,
        59,
        103,
        12,
        74,
        12,
        103,
        53,
        170,
        127,
        59,
        15,
        28,
        229,
        86,
        234,
        233,
        252,
        201,
        75,
        80,
        27,
        44,
        135,
        129,
        186,
        80,
        168,
        198,
        34,
        14,
        130,
        70,
        55,
        28,
        60,
        115,
        89,
        254,
        78,
        249,
        218,
        120,
        108,
        167,
        217,
        130,
        86,
        117,
        76,
        164,
        228,
        150,
        190,
        10,
        145,
        116,
        190,
        219,
        236,
        179,
        132,
        189,
        244,
        112,
        119,
        145,
        134,
        214,
        168,
        51,
        240,
        104,
        210,
        131,
        138,
        136,
        217,
        14,
        243,
        173,
        72,
        255,
        150,
        59,
        103,
        195,
        156,
        197,
        163,
        238,
        18,
        59,
        175,
        123,
        243,
        18,
        95,
        100,
        231,
        122,
        247,
        243,
        14,
        16,
        93,
        114,
        196,
        185,
        181,
        178,
        55,
        237,
        37,
        30,
        76,
        18,
        44,
        109,
        140,
        20,
        5,
        231,
        54,
        41,
        156,
        58,
        253,
        109,
        177,
        106,
        40,
        198,
        169,
        207,
        166,
        130,
        65,
        229,
        61,
        228,
        205,
        56,
        130,
        113,
        254,
        83,
        74,
        106,
        155,
        13,
        190,
        166,
        23,
        29,
        23,
        13,
        177,
        184,
        152,
        88,
        70,
        136,
        133,
        208,
        143,
        236,
        189,
        84,
        200,
        228,
        113,
        195,
        226,
        93,
        72,
        233,
        123,
        164,
        80,
        185,
        109,
        13,
        135,
        224,
        10,
        199,
        50,
        170,
        160,
        211,
        206,
        67,
        9,
        193,
        6,
        75,
        216,
        164,
        192,
        128,
        138,
        151,
        224,
        20,
        62,
        67,
        162,
        76,
        250,
        132,
        118,
        53,
        18,
        92,
        212,
        28,
        19,
        224,
        87,
        68,
        135,
        150,
        62,
        157,
        114,
        92,
        1,
        55,
        93,
        185,
        156,
        49,
        218,
        103,
        180,
        207,
        101,
        239,
        245,
        85,
        240,
        192,
        172,
        65,
        108,
        114,
        127,
        248,
        212,
        56,
        173,
        124,
        66,
        3,
        5,
        81,
        214,
        140,
        46,
        122,
        221,
        160,
        171,
        177,
        202,
        124,
        16
    ]
        .span();

    vm.message.data = calldata;
    let expected_gas = 1365;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}

#[test]
#[available_gas(10000000000000)]
// name: "nagydani_3_qube"
fn test_mod_exp_precompile_14() {
    let mut vm = VMBuilderTrait::new_with_presets().build();

    let calldata = array![
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        219,
        52,
        208,
        228,
        56,
        36,
        156,
        14,
        214,
        133,
        201,
        73,
        204,
        40,
        119,
        106,
        5,
        9,
        78,
        28,
        72,
        105,
        29,
        195,
        242,
        220,
        165,
        252,
        51,
        86,
        210,
        160,
        102,
        59,
        211,
        118,
        228,
        113,
        40,
        57,
        145,
        126,
        185,
        161,
        156,
        103,
        4,
        7,
        226,
        195,
        119,
        162,
        222,
        56,
        90,
        63,
        243,
        181,
        33,
        4,
        247,
        241,
        244,
        224,
        199,
        191,
        119,
        23,
        251,
        145,
        56,
        150,
        105,
        61,
        197,
        237,
        187,
        101,
        183,
        96,
        239,
        27,
        0,
        228,
        46,
        157,
        143,
        154,
        241,
        115,
        82,
        56,
        94,
        28,
        215,
        66,
        201,
        176,
        6,
        192,
        246,
        105,
        153,
        92,
        176,
        187,
        33,
        210,
        140,
        10,
        206,
        210,
        137,
        34,
        103,
        99,
        123,
        100,
        112,
        216,
        206,
        224,
        171,
        39,
        252,
        93,
        66,
        101,
        143,
        110,
        136,
        36,
        12,
        49,
        214,
        119,
        74,
        166,
        10,
        126,
        189,
        37,
        205,
        72,
        181,
        109,
        13,
        161,
        18,
        9,
        241,
        146,
        142,
        97,
        0,
        92,
        110,
        183,
        9,
        243,
        232,
        224,
        170,
        248,
        217,
        177,
        15,
        125,
        126,
        41,
        109,
        119,
        34,
        100,
        220,
        118,
        137,
        124,
        205,
        221,
        173,
        201,
        30,
        250,
        145,
        193,
        144,
        59,
        114,
        50,
        169,
        228,
        195,
        185,
        65,
        145,
        123,
        153,
        163,
        188,
        12,
        38,
        73,
        125,
        237,
        200,
        151,
        194,
        87,
        80,
        175,
        96,
        35,
        122,
        166,
        121,
        52,
        162,
        106,
        43,
        196,
        145,
        219,
        61,
        204,
        103,
        116,
        145,
        148,
        75,
        193,
        245,
        29,
        62,
        93,
        118,
        184,
        216,
        70,
        166,
        45,
        176,
        61,
        237,
        214,
        31,
        245,
        8,
        249,
        26,
        86,
        215,
        16,
        40,
        18,
        80,
        53,
        195,
        164,
        76,
        187,
        4,
        20,
        151,
        200,
        59,
        243,
        228,
        174,
        42,
        150,
        19,
        164,
        1,
        204,
        114,
        28,
        84,
        122,
        42,
        250,
        59,
        22,
        162,
        150,
        153,
        51,
        211,
        98,
        110,
        214,
        216,
        167,
        66,
        134,
        72,
        247,
        65,
        34,
        253,
        63,
        42,
        2,
        162,
        7,
        88,
        247,
        246,
        147,
        137,
        44,
        143,
        215,
        152,
        179,
        154,
        186,
        192,
        29,
        24,
        80,
        108,
        69,
        231,
        20,
        50,
        99,
        158,
        159,
        149,
        5,
        113,
        158,
        232,
        34,
        246,
        44,
        203,
        244,
        127,
        104,
        80,
        240,
        150,
        255,
        119,
        181,
        175,
        175,
        75,
        231,
        215,
        114,
        2,
        87,
        145,
        113,
        125,
        190,
        90,
        191,
        155,
        63,
        64,
        207,
        247,
        215,
        170,
        182,
        246,
        126,
        56,
        246,
        47,
        175,
        81,
        7,
        71,
        39,
        110,
        32,
        164,
        33,
        39,
        231,
        80,
        12,
        68,
        79,
        158,
        217,
        43,
        175,
        101,
        173,
        233,
        232,
        54,
        132,
        94,
        57,
        196,
        49,
        109,
        157,
        206,
        95,
        142,
        44,
        128,
        131,
        226,
        192,
        172,
        187,
        149,
        41,
        110,
        5,
        229,
        26,
        171,
        19,
        182,
        184,
        245,
        63,
        6,
        201,
        196,
        39,
        110,
        18,
        176,
        103,
        17,
        51,
        33,
        140,
        195,
        234,
        144,
        125,
        163,
        189,
        154,
        54,
        112,
        150,
        217,
        32,
        33,
        40,
        209,
        72,
        70,
        204,
        46,
        32,
        213,
        111,
        200,
        71,
        62,
        203,
        7,
        206,
        203,
        251,
        128,
        134,
        145,
        159,
        57,
        113,
        146,
        110,
        112,
        69,
        184,
        83,
        216,
        90,
        105,
        208,
        38,
        25,
        92,
        112,
        249,
        247,
        168,
        35,
        83,
        110,
        42,
        143,
        75,
        62,
        18,
        233,
        77,
        155,
        83,
        169,
        52,
        53,
        52,
        81,
        9,
        75,
        129,
        3,
        223,
        49,
        67,
        160,
        5,
        116,
        87,
        215,
        94,
        140,
        112,
        139,
        99,
        55,
        166,
        245,
        164,
        253,
        26,
        6,
        114,
        122,
        207,
        159,
        185,
        62,
        41,
        147,
        198,
        47,
        51,
        120,
        179,
        125,
        86,
        200,
        94,
        123,
        30,
        0,
        240,
        20,
        94,
        191,
        142,
        64,
        149,
        189,
        114,
        49,
        102,
        41,
        60,
        96,
        182,
        172,
        18,
        82,
        41,
        30,
        246,
        88,
        35,
        201,
        224,
        64,
        221,
        173,
        20,
        150,
        155,
        59,
        52,
        10,
        78,
        247,
        20,
        219,
        9,
        58,
        88,
        124,
        55,
        118,
        109,
        104,
        184,
        214,
        181,
        1,
        110,
        116,
        21,
        135,
        231,
        230,
        191,
        126,
        118,
        59,
        68,
        240,
        36,
        126,
        100,
        186,
        227,
        15,
        153,
        77,
        36,
        139,
        253,
        32,
        84,
        26,
        51,
        62,
        91,
        34,
        94,
        246,
        166,
        17,
        153,
        227,
        1,
        115,
        139,
        30,
        104,
        143,
        112,
        236,
        29,
        127,
        184,
        146,
        193,
        131,
        201,
        93,
        197,
        67,
        195,
        225,
        42,
        223,
        138,
        94,
        139,
        156,
        169,
        208,
        79,
        148,
        69,
        204,
        237,
        58,
        178,
        86,
        242,
        158,
        153,
        142,
        105,
        239,
        170,
        99,
        58,
        123,
        96,
        225,
        219,
        90,
        134,
        121,
        36,
        204,
        171,
        10,
        23,
        29,
        157,
        110,
        16,
        152,
        223,
        161,
        90,
        205,
        233,
        85,
        61,
        229,
        153,
        234,
        165,
        100,
        144,
        200,
        244,
        17,
        228,
        152,
        81,
        17,
        243,
        212,
        11,
        221,
        252,
        94,
        48,
        30,
        219,
        1,
        84,
        123,
        1,
        168,
        134,
        85,
        10,
        97,
        21,
        143,
        126,
        32,
        51,
        197,
        151,
        7,
        120,
        155,
        247,
        200,
        84,
        24,
        29,
        12,
        46,
        42,
        66,
        169,
        60,
        240,
        146,
        9,
        116,
        125,
        112,
        130,
        225,
        71,
        235,
        133,
        68,
        222,
        37,
        195,
        235,
        20,
        242,
        227,
        85,
        89,
        234,
        12,
        15,
        88,
        119,
        242,
        243,
        252,
        146,
        19,
        44,
        10,
        233,
        218,
        78,
        69,
        178,
        246,
        200,
        102,
        162,
        36,
        234,
        109,
        31,
        40,
        192,
        83,
        32,
        226,
        135,
        117,
        15,
        188,
        100,
        115,
        104,
        212,
        17,
        22,
        229,
        40,
        1,
        76,
        193,
        133,
        46,
        85,
        49,
        213,
        62,
        74,
        249,
        56,
        55,
        77,
        171,
        166,
        206,
        228,
        186,
        168,
        33,
        237,
        7,
        17,
        114,
        83,
        187,
        54,
        1,
        221,
        208,
        13,
        89,
        163,
        215,
        251,
        46,
        241,
        245,
        162,
        251,
        186,
        124,
        66,
        159,
        12,
        249,
        165,
        179,
        70,
        36,
        16,
        253,
        131,
        58,
        105,
        17,
        143,
        139,
        233,
        197,
        89,
        177,
        0,
        12,
        198,
        8,
        253,
        135,
        127,
        180,
        63,
        142,
        101,
        194,
        209,
        48,
        38,
        34,
        185,
        68,
        70,
        37,
        121,
        5,
        104,
        116,
        179,
        135,
        32,
        141,
        144,
        98,
        63,
        205,
        175,
        147,
        146,
        12,
        167,
        169,
        228,
        186,
        100,
        234,
        32,
        135,
        88,
        34,
        42,
        216,
        104,
        80,
        28,
        194,
        195,
        69,
        226,
        211,
        165,
        234,
        42,
        23,
        229,
        6,
        146,
        72,
        19,
        140,
        138,
        121,
        192,
        37,
        17,
        133,
        210,
        158,
        231,
        62,
        90,
        250,
        181,
        53,
        71,
        105,
        20,
        45,
        43,
        240,
        203,
        103,
        18,
        114,
        122,
        166,
        191,
        132,
        166,
        36,
        95,
        205,
        174,
        102,
        228,
        147,
        141,
        132,
        209,
        185,
        221,
        9,
        168,
        132,
        129,
        134,
        34,
        8,
        15,
        245,
        249,
        137,
        66,
        251,
        32,
        172,
        215,
        224,
        201,
        22,
        194,
        213,
        234,
        124,
        230,
        247,
        225,
        115,
        49,
        83,
        132,
        81,
        143
    ]
        .span();
    let expected = array![
        90,
        38,
        100,
        37,
        42,
        186,
        45,
        110,
        25,
        217,
        96,
        13,
        165,
        130,
        205,
        209,
        240,
        157,
        122,
        137,
        10,
        196,
        142,
        107,
        141,
        161,
        90,
        231,
        198,
        255,
        24,
        86,
        252,
        103,
        168,
        65,
        172,
        35,
        20,
        210,
        131,
        255,
        163,
        202,
        129,
        160,
        236,
        247,
        194,
        125,
        137,
        239,
        145,
        165,
        168,
        147,
        41,
        121,
        40,
        245,
        218,
        2,
        69,
        201,
        150,
        69,
        103,
        107,
        72,
        27,
        126,
        32,
        165,
        102,
        238,
        106,
        79,
        36,
        129,
        148,
        43,
        238,
        25,
        29,
        238,
        197,
        84,
        70,
        0,
        187,
        36,
        65,
        253,
        15,
        177,
        158,
        46,
        231,
        216,
        1,
        173,
        137,
        17,
        198,
        183,
        117,
        10,
        255,
        236,
        54,
        122,
        75,
        41,
        162,
        41,
        66,
        192,
        245,
        244,
        116,
        74,
        78,
        119,
        168,
        182,
        84,
        218,
        42,
        130,
        87,
        16,
        55,
        9,
        158,
        156,
        109,
        147,
        7,
        148,
        239,
        229,
        205,
        202,
        115,
        199,
        182,
        192,
        132,
        78,
        56,
        107,
        220,
        168,
        234,
        1,
        179,
        215,
        128,
        113,
        70,
        187,
        129,
        54,
        94,
        44,
        220,
        100,
        117,
        248,
        194,
        62,
        15,
        248,
        68,
        99,
        18,
        97,
        137,
        220,
        151,
        137,
        247,
        43,
        188,
        226,
        227,
        210,
        209,
        20,
        215,
        40,
        162,
        114,
        241,
        52,
        81,
        34,
        222,
        35,
        223,
        84,
        201,
        34,
        236,
        122,
        22,
        229,
        194,
        168,
        248,
        77,
        168,
        135,
        20,
        130,
        189,
        37,
        140,
        32,
        167,
        192,
        155,
        188,
        214,
        76,
        122,
        150,
        165,
        16,
        41,
        187,
        254,
        132,
        135,
        54,
        166,
        186,
        123,
        249,
        217,
        49,
        169,
        183,
        222,
        11,
        202,
        243,
        99,
        80,
        52,
        212,
        149,
        139,
        32,
        174,
        154,
        179,
        169,
        90,
        20,
        123,
        4,
        33,
        221,
        95,
        126,
        191,
        244,
        108,
        151,
        16,
        16,
        235,
        252,
        74,
        219,
        190,
        10,
        217,
        77,
        84,
        152,
        200,
        83,
        231,
        20,
        44,
        69,
        13,
        140,
        113,
        222,
        75,
        47,
        132,
        237,
        191,
        138,
        205,
        46,
        22,
        208,
        12,
        129,
        21,
        177,
        80,
        177,
        195,
        14,
        85,
        61,
        187,
        130,
        99,
        94,
        120,
        19,
        121,
        254,
        42,
        86,
        54,
        4,
        32,
        255,
        126,
        159,
        112,
        204,
        100,
        192,
        10,
        186,
        126,
        38,
        237,
        19,
        199,
        193,
        150,
        34,
        134,
        90,
        224,
        114,
        72,
        218,
        206,
        211,
        100,
        22,
        8,
        15,
        53,
        248,
        204,
        21,
        122,
        133,
        126,
        215,
        14,
        164,
        243,
        71,
        241,
        125,
        27,
        238,
        128,
        250,
        3,
        138,
        189,
        110,
        57,
        177,
        186,
        6,
        185,
        114,
        100,
        56,
        139,
        33,
        54,
        79,
        124,
        86,
        225,
        146,
        212,
        182,
        45,
        155,
        22,
        20,
        5,
        243,
        42,
        177,
        226,
        89,
        78,
        134,
        36,
        62,
        86,
        252,
        242,
        203,
        48,
        210,
        26,
        222,
        241,
        91,
        153,
        64,
        249,
        26,
        246,
        129,
        218,
        36,
        50,
        140,
        136,
        61,
        137,
        38,
        112,
        198,
        170,
        71,
        148,
        8,
        103,
        168,
        24,
        48,
        168,
        43,
        130,
        113,
        104,
        149,
        219,
        129,
        13,
        241,
        184,
        52,
        100,
        10,
        190,
        251,
        125,
        178,
        9,
        45,
        217,
        41,
        18,
        203,
        154,
        115,
        81,
        117,
        188,
        68,
        123,
        228,
        10,
        80,
        60,
        242,
        45,
        254,
        86,
        91,
        78,
        215,
        163,
        41,
        60,
        160,
        223,
        214,
        58,
        80,
        116,
        48,
        179,
        35,
        238,
        36,
        142,
        200,
        46,
        132,
        59,
        103,
        60,
        151,
        173,
        115,
        7,
        40,
        206,
        188
    ]
        .span();

    vm.message.data = calldata;
    ModExpPrecompileTrait::exec(ref vm).unwrap();

    assert_eq!(vm.return_data, expected);

    let expected_gas = 1365;

    let gas_before = vm.gas_left;
    ModExpPrecompileTrait::exec(ref vm).unwrap();
    let gas_after = vm.gas_left;

    assert_eq!(gas_before - gas_after, expected_gas);
    assert_eq!(vm.return_data, expected);
}
